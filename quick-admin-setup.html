<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Configuraci√≥n R√°pida de Admins - VET360</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="./assets/css/style.css">
</head>
<body class="d-flex align-items-center justify-content-center vh-100">

<div class="container">
    <div class="row justify-content-center">
        <div class="col-lg-6 col-md-8">
            <div class="card p-4">
                <div class="card-body">
                    <div class="text-center mb-4">
                        <img src="./assets/imagenes/logovet360opcion 1.jpg" alt="VET360 Logo" class="logo-img">
                        <h1 class="logo">VET360 üêæ</h1>
                        <h2>Configuraci√≥n R√°pida de Admins</h2>
                        <p class="text-muted">Crea perfiles de administrador para usuarios existentes</p>
                    </div>
                    
                    <div id="error-message" class="alert alert-danger d-none" role="alert"></div>
                    <div id="success-message" class="alert alert-success d-none" role="alert"></div>
                    <div id="info-message" class="alert alert-info" role="alert">
                        üîß Esta p√°gina crea perfiles de administrador usando los UIDs de Firebase Authentication.
                    </div>
                    
                    <form id="quick-setup-form">
                        <h5>üë§ Configurar Administradores</h5>
                        
                        <div class="mb-3">
                            <label class="form-label">Usuario 1</label>
                            <div class="input-group">
                                <span class="input-group-text">üìß</span>
                                <input type="text" class="form-control" value="mperdomo591@gmail.com" readonly title="Email del Usuario 1">
                                <span class="input-group-text">üÜî</span>
                                <input type="text" class="form-control" id="uid1" placeholder="UID del usuario" required>
                            </div>
                            <small class="form-text text-muted">UID: wUdg94yAErYJQgAtY6jAGQLE...</small>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">Usuario 2</label>
                            <div class="input-group">
                                <span class="input-group-text">üìß</span>
                                <input type="text" class="form-control" value="10luisdominguez@gmail.com" readonly title="Email del Usuario 2">
                                <span class="input-group-text">üÜî</span>
                                <input type="text" class="form-control" id="uid2" placeholder="UID del usuario" required>
                            </div>
                            <small class="form-text text-muted">UID: amaocGrk15Vp6DDq0RbhGPn...</small>
                        </div>
                        
                        <div class="alert alert-warning">
                            ‚ö†Ô∏è <strong>Importante:</strong> Los UIDs se encuentran en la consola de Firebase Authentication.
                        </div>
                        
                        <div class="d-grid">
                            <button type="submit" class="btn btn-primary btn-lg" id="setup-btn">
                                <span class="btn-text">Crear Perfiles de Admin</span>
                                <span class="spinner-border spinner-border-sm d-none" role="status" aria-hidden="true"></span>
                            </button>
                        </div>
                    </form>
                    
                    <div id="success-panel" class="d-none mt-4">
                        <div class="alert alert-success">
                            <h5>‚úÖ ¬°Configuraci√≥n completada!</h5>
                            <p>Los perfiles de administrador han sido creados exitosamente.</p>
                            <hr>
                            <p class="mb-0">
                                <strong>Pr√≥ximos pasos:</strong>
                                <br>1. Ir a la p√°gina de <a href="login.html" class="btn btn-sm btn-primary">Login</a>
                                <br>2. Iniciar sesi√≥n con cualquiera de las cuentas
                                <br>3. Acceder al dashboard de administrador
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Firebase SDK v9 (modular) -->
<script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js';
    import { getFirestore, doc, setDoc } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js';

    // Firebase configuration
    const firebaseConfig = {
        apiKey: "AIzaSyBZoyZqhODCH90zcPdY_iT8mhh2S-X5FRE",
        authDomain: "vet360-d262a.firebaseapp.com",
        databaseURL: "https://vet360-d262a-default-rtdb.firebaseio.com",
        projectId: "vet360-d262a",
        storageBucket: "vet360-d262a.firebasestorage.app",
        messagingSenderId: "184009559961",
        appId: "1:184009559961:web:12b1311b6224a5d58ecd08",
        measurementId: "G-5K02J1Z7VZ"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // UI elements
    const setupForm = document.getElementById('quick-setup-form');
    const setupBtn = document.getElementById('setup-btn');
    const errorMessage = document.getElementById('error-message');
    const successMessage = document.getElementById('success-message');
    const infoMessage = document.getElementById('info-message');
    const successPanel = document.getElementById('success-panel');

    // Admin permissions (full access)
    const ADMIN_PERMISSIONS = [
        'full_access',
        'manage_users',
        'create_users',
        'edit_users',
        'delete_users',
        'view_reports',
        'system_settings',
        'manage_billing',
        'view_patients',
        'create_patients',
        'edit_patients',
        'delete_patients',
        'view_appointments',
        'create_appointments',
        'edit_appointments',
        'delete_appointments',
        'view_medical_records',
        'create_medical_records',
        'edit_medical_records'
    ];

    // User data
    const users = [
        {
            email: 'mperdomo591@gmail.com',
            firstName: 'Michel',
            lastName: 'Perdomo',
            employeeId: 'VET360-ADMIN-001'
        },
        {
            email: '10luisdominguez@gmail.com',
            firstName: 'Luis',
            lastName: 'Dom√≠nguez',
            employeeId: 'VET360-ADMIN-002'
        }
    ];

    // Show/hide elements
    function showElement(element) {
        element.classList.remove('d-none');
    }

    function hideElement(element) {
        element.classList.add('d-none');
    }

    // Show loading state
    function showLoading(show) {
        const btnText = setupBtn.querySelector('.btn-text');
        const spinner = setupBtn.querySelector('.spinner-border');
        
        if (show) {
            btnText.textContent = 'Creando perfiles...';
            showElement(spinner);
            setupBtn.disabled = true;
        } else {
            btnText.textContent = 'Crear Perfiles de Admin';
            hideElement(spinner);
            setupBtn.disabled = false;
        }
    }

    // Show messages
    function showError(message) {
        errorMessage.textContent = message;
        showElement(errorMessage);
        hideElement(successMessage);
    }

    function showSuccess(message) {
        successMessage.textContent = message;
        showElement(successMessage);
        hideElement(errorMessage);
    }

    function hideMessages() {
        hideElement(errorMessage);
        hideElement(successMessage);
    }

    // Create admin profiles
    async function createAdminProfiles(uid1, uid2) {
        showLoading(true);
        hideMessages();

        try {
            console.log('Creating admin profiles...');
            
            // Create profile for user 1
            const adminProfile1 = {
                uid: uid1,
                email: users[0].email,
                firstName: users[0].firstName,
                lastName: users[0].lastName,
                role: 'admin',
                department: 'administracion',
                employeeId: users[0].employeeId,
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString(),
                requirePasswordChange: false,
                isActive: true,
                permissions: ADMIN_PERMISSIONS,
                isConfigured: true,
                profileCompleted: true,
                isDefaultAdmin: true
            };

            // Create profile for user 2
            const adminProfile2 = {
                uid: uid2,
                email: users[1].email,
                firstName: users[1].firstName,
                lastName: users[1].lastName,
                role: 'admin',
                department: 'administracion',
                employeeId: users[1].employeeId,
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString(),
                requirePasswordChange: false,
                isActive: true,
                permissions: ADMIN_PERMISSIONS,
                isConfigured: true,
                profileCompleted: true,
                isDefaultAdmin: true
            };

            console.log('Saving profiles to Firestore...');
            
            // Save both profiles to Firestore
            await Promise.all([
                setDoc(doc(db, 'users', uid1), adminProfile1),
                setDoc(doc(db, 'users', uid2), adminProfile2)
            ]);

            console.log('Profiles created successfully');
            showSuccess('‚úÖ Perfiles de administrador creados exitosamente para ambos usuarios.');
            
            // Show success panel
            setTimeout(() => {
                hideElement(setupForm);
                hideElement(infoMessage);
                showElement(successPanel);
            }, 2000);

        } catch (error) {
            console.error('Error creating admin profiles:', error);
            
            let errorMsg = 'üö® Error al crear perfiles. Verifica la consola para m√°s detalles.';
            
            if (error.code === 'permission-denied') {
                errorMsg = 'üö´ Error de permisos en Firestore. Verifica la configuraci√≥n de la base de datos.';
            } else if (error.code === 'unavailable') {
                errorMsg = 'üì° Firestore no est√° disponible. Intenta m√°s tarde.';
            } else if (error.message.includes('Invalid document reference')) {
                errorMsg = '‚ùå UIDs inv√°lidos. Verifica que sean correctos.';
            }
            
            showError(errorMsg);
        } finally {
            showLoading(false);
        }
    }

    // Form submission
    setupForm.addEventListener('submit', function(e) {
        e.preventDefault();
        
        const uid1 = document.getElementById('uid1').value.trim();
        const uid2 = document.getElementById('uid2').value.trim();

        // Basic validation
        if (!uid1 || !uid2) {
            showError('‚ùå Ambos UIDs son requeridos.');
            return;
        }

        if (uid1.length < 20 || uid2.length < 20) {
            showError('‚ùå Los UIDs parecen ser muy cortos. Verifica que sean correctos.');
            return;
        }

        if (uid1 === uid2) {
            showError('‚ùå Los UIDs deben ser diferentes para cada usuario.');
            return;
        }

        createAdminProfiles(uid1, uid2);
    });
</script>

</body>
</html>